# vim: ft=make noexpandtab

INSTALL_DIR := $(if $(rubyarchdir),$(rubyarchdir),$(RUBYARCHDIR))/prestogres
PGPOOL2_PATH = $(realpath $(srcdir)/../pgpool2)

CFLAGS += -DPRESTOGRES_PREFIX="\"$(INSTALL_DIR)\""

all: pgpool2

clean: clean-pgpool2

install: install-pgpool2

pgpool2:
	mkdir -p build
	cd build && "$(PGPOOL2_PATH)/configure" \
		CFLAGS="-I$(PGPOOL2_PATH)" \
		--with-openssl \
		--prefix="$(INSTALL_DIR)"
	cd build && make sysconfdir=/opt/prestogres/etc

clean-pgpool2:
	@rm -rf build

install-pgpool2:
	cd build && make install

